{% extends 'template.twig' %}
{% block title %}
    Ch.{{ article.articleNumber}} - {{parent()}}
{% endblock %}
{% block body %}

    <header class="container-fluid header-other-pages">  

            <div>
                <h1 >{{ article.articleNumber}} - {{ article.title}}</h1>
                <h5><em>{{ article.dateCreation}}</em></h5>
                
            </div>
        </header>

        <main class="container-fluid main"> 

                <div class="row">

                    <!-- display article's content -->
                    <div class="col-xs-12 subdivision">
                        <h3>Un peu de lecture</h3>
                    </div>


                    <div class="col-xs-10 col-xs-push-1">
                        <div class="comments">
                           <p>{{ article.content|raw }}</p>
                           <!--<p>blablabla</p>-->
                        </div>
                    </div>
    
                    <!-- display comments -->
                    <div class="col-xs-12 subdivision">
                        <h3>Commentaires</h3>
                    </div>
        


                    <div class="col-xs-10 col-xs-push-1">
                        
                        {% if comments is NULL %}
                        
                            <div class="comments">
                                <p>Il n'y a pas encore de commentaires</p>
                            </div>

                        {% else %}
                            {% commentGrp in comments %}
                            <!--foreach ($comments as $commentGrp)
                            {   -->
                        
                        
                                <div class="comments">
                                {% comment in commentGrp %}
                                <!--foreach($commentGrp as $comment)
                                {-->
                                    {% if not comment.parentId ==0 %}
                                    <!--if ($comment->getParentId() !=0) 
                                    { -->          
                                        <div class="answer">
                                            <p><strong>{{ comment.author|e }}</strong> le {{ comment.commentDate }}</p>
                                            <p>{{ comment.comment|e|nl2br }}</p>

                                            {% if comment.moderationStatus %}
                                            <!--if ($comment->getModerationStatus() !=2)
                                            { --> 
                                                <form method="post" action="index.php?action=alertComment&amp;id=<?= $article->getId(); ?>&amp;commentId=<?= $comment->getId(); ?>&amp;alert=1">
                                                    <button type="submit" name="alert">Signaler</button>
                                                </form>
                                            {% endif %}
                                        </div>
                                    
                                    
                                    {% else %}               
                                        <div class="comment">
                                            <div >
                                                <p><strong>{{ comment.author|e }}</strong> le <?= htmlspecialchars($comment->getCommentDate()); ?></p>
                                                <p><?= nl2br(htmlspecialchars($comment->getComment())); ?></p>
                                            </div>  

                                            <div class="panel-group" id="accordion<?= $comment->getId();?>" aria-multiselectable="false">
                                                <div class="panel panel-default">
                                                    <div class="panel-heading" id="headingOne">
                                                        <button data-toggle="collapse" data-parent="#accordion<?= $comment->getId(); ?>" href= "#collapse<?= $comment->getId(); ?>" aria-expanded="false" aria-controls="collapseOne">Répondre</button>  
                            <?php
                        
                                                    if ($comment->getModerationStatus() !=2) 
                                                    {  
                        ?>
                                                        <form method="post" action="index.php?action=alertComment&amp;id=<?= $article->getId(); ?>&amp;commentId=<?= $comment->getId(); ?>&amp;alert=1">
                                                            <button type="submit" name="alert">Signaler</button>
                                                        </form>
                        <?php

                                                    }       
                        ?>

                                                </div>
                                        


                                                <div id="collapse<?= $comment->getId(); ?>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                                                    <div class="panel-body">

                                                        <form  method="post" action="index.php?action=addComment&amp;id=<?= $article->getId(); ?>&amp;parentId=<?= $comment->getId(); ?>">

                                                                
                                                            <p><input class="author" type="text" name="author" placeholder="Votre nom" required></p>
                                                            <p><textarea id="answer" name="comment" placeholder="Saisissez votre réponse ici" required></textarea></p>
                                                            <button type="submit" name="answer">Envoyer la réponse</button>
                                                                    
                                                        </form>

                                                        
                                                    </div>
                                                </div>           
                                            </div>
                                        </div>
                                    </div>
                        <?php    
                                }
                      
                            }
                        
                        ?>
                            </div> 
                            
                        <?php
                        }
                    }
                        ?>
                            
                    </div>
                    
               
                    <!-- display form to add a comment -->
                    <div class="col-xs-12 subdivision">
                        <h3>Exprimez-vous !!!</h3>
                    </div>
        
                    <div class="col-xs-10 col-xs-push-1 ">

                        <form class="comment-form" method="post" action="index.php?action=addComment&amp;id=<?= $article->getId(); ?>&amp;parentId=0&amp;chapitre=<?= $article->getArticleNumber(); ?>">

                            <p>Laissez un message ;-)</p>
                            <p><input class="author" type="text" name="author" placeholder="Votre nom" required></p>
                            <p><textarea id="comment" name="comment" placeholder="Saisissez votre commentaire ici" required></textarea></p>
                            <p><input type="submit" value="Envoyer"></p>

                        </form>
                    </div>
                </div>
            
        </main>
        <?php require ('src/view/templates/_footer.php'); ?>  
    